"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function i(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}();function _defineProperty(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Litebox=function(){function n(t){_classCallCheck(this,n),n._isObject(t)?this.options=n._merge(n.defaults,t):this.options=n.defaults,this._current=null,this.VERSION="0.7.0",this._init()}return _createClass(n,[{key:"_init",value:function(){this._buildCollection(),this._createElements(),this._applyAttributes(),this._createStructure(),this.registerMouseEvents()}},{key:"_createElements",value:function(){this._structure={BUTTON_CLOSE:document.createElement("button"),BUTTON_NEXT:document.createElement("button"),BUTTON_PREV:document.createElement("button"),OUTER_WRAPPER:document.createElement("div"),INNER_WRAPPER:document.createElement("div"),FIGURE:document.createElement("figure"),CAPTION:document.createElement("figcaption"),IMAGE:document.createElement("img"),LOADER:document.createElement("div"),ERROR:document.createElement("div")}}},{key:"_applyAttributes",value:function(){this._structure.OUTER_WRAPPER.className=this.options.classNames.outer+" "+(this.options.animation&&"-fade-in"),this._structure.INNER_WRAPPER.className=this.options.classNames.inner,this._structure.BUTTON_CLOSE.className=this.options.classNames.buttonGeneral+" "+this.options.classNames.buttonClose+" "+this.options.classNames.hidden,this._structure.BUTTON_CLOSE.textContent=this.options.labels.close,this._structure.BUTTON_NEXT.className=this.options.classNames.buttonGeneral+" "+this.options.classNames.buttonNext+" "+this.options.classNames.hidden,this._structure.BUTTON_NEXT.textContent=this.options.labels.next,this._structure.BUTTON_PREV.className=this.options.classNames.buttonGeneral+" "+this.options.classNames.buttonPrev+" "+this.options.classNames.hidden,this._structure.BUTTON_PREV.textContent=this.options.labels.prev,this._structure.FIGURE.className=this.options.classNames.figure,this._structure.CAPTION.className=this.options.classNames.caption+" "+this.options.classNames.hidden,this._structure.IMAGE.className=this.options.classNames.image+" "+this.options.classNames.hidden,this._structure.LOADER.className=this.options.classNames.loader+" "+this.options.classNames.hidden,this._structure.ERROR.className=this.options.classNames.error+" "+this.options.classNames.hidden,this._structure.ERROR.textContent=this.options.labels.error}},{key:"_createStructure",value:function(){this._structure.OUTER_WRAPPER.appendChild(this._structure.INNER_WRAPPER),this._structure.OUTER_WRAPPER.appendChild(this._structure.LOADER),this._structure.OUTER_WRAPPER.appendChild(this._structure.ERROR),this._structure.INNER_WRAPPER.appendChild(this._structure.BUTTON_CLOSE),this._structure.INNER_WRAPPER.appendChild(this._structure.BUTTON_NEXT),this._structure.INNER_WRAPPER.appendChild(this._structure.BUTTON_PREV),this._structure.INNER_WRAPPER.appendChild(this._structure.FIGURE),this._structure.FIGURE.appendChild(this._structure.IMAGE),this._structure.FIGURE.appendChild(this._structure.CAPTION),this._LITEBOX=this._structure.OUTER_WRAPPER}},{key:"registerKeyboardEvents",value:function(){var e=this;this.options.keyboardShortcuts&&window.addEventListener("keydown",function(t){e.isHidden()||(27===t.keyCode&&e.close(),39===t.keyCode&&e.next(),37===t.keyCode&&e.prev())})}},{key:"registerTouchEvents",value:function(){var i=this;if(this.options.touch){var n=null,r=null;window.addEventListener("touchstart",function(t){i.isHidden()||(n=t.touches[0].clientX,r=t.touches[0].clientY)}),window.addEventListener("touchmove",function(t){if(!i.isHidden()&&n&&r){var e=t.touches[0].clientX,s=t.touches[0].clientY;Math.abs(n-e)>Math.abs(r-s)?0<n-e?i.next():i.prev():r-s<0&&i.close(),r=n=null}})}}},{key:"registerMouseEvents",value:function(){var s=this;for(var t in this._collection){var e=function(e){e.addEventListener("click",function(t){t.preventDefault(),s._show(e)})},i=!0,n=!1,r=void 0;try{for(var o,u=this._collection[t][Symbol.iterator]();!(i=(o=u.next()).done);i=!0){e(o.value)}}catch(t){n=!0,r=t}finally{try{!i&&u.return&&u.return()}finally{if(n)throw r}}}this._structure.BUTTON_CLOSE.addEventListener("click",this._close.bind(this)),this._structure.BUTTON_NEXT.addEventListener("click",this._next.bind(this)),this._structure.BUTTON_PREV.addEventListener("click",this._prev.bind(this))}},{key:"_show",value:function(t){var e=this;document.body.contains(this._LITEBOX)||document.body.appendChild(this._LITEBOX),this._showLoader(),this._load(t).then(function(){e._current=t,e._structure.IMAGE.classList.remove(e.options.classNames.hidden),e._hideLoader(),e._toggleButtons(),e._toggleCaption(t.getAttribute(e.options.caption))}).catch(function(){e._current=null,e._hideLoader(),e._toggleButtons(),e._showError()})}},{key:"_close",value:function(){document.body.removeChild(this._LITEBOX),this._current=null,this._applyAttributes()}},{key:"_load",value:function(t){var s=this,i=t.getAttribute(this.options.target);if(i)return new Promise(function(t,e){s._structure.IMAGE.src=i,s._structure.IMAGE.onload=t,s._structure.IMAGE.onerror=e})}},{key:"_toggleCaption",value:function(t){t?(this._structure.CAPTION.textContent=t,this._structure.CAPTION.classList.remove("hidden")):this._structure.CAPTION.classList.add("hidden")}},{key:"_toggleButtons",value:function(){this._structure.BUTTON_CLOSE.classList.remove("hidden"),this._isInGallery()&&(this._isLast()?this._structure.BUTTON_NEXT.classList.add("hidden"):this._structure.BUTTON_NEXT.classList.remove("hidden"),this._isFirst()?this._structure.BUTTON_PREV.classList.add("hidden"):this._structure.BUTTON_PREV.classList.remove("hidden"))}},{key:"_next",value:function(){this._show(this._getNext())}},{key:"_prev",value:function(){this._show(this._getPrev())}},{key:"showControls",value:function(){var t=this;this._outer.classList.remove("-inactive"),this.timeout=setTimeout(function(){t.hideControls()},2e3)}},{key:"hideControls",value:function(){this._outer.classList.add("-inactive")}},{key:"clearTimeout",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){clearTimeout(this.timeout),this.showControls()})},{key:"isHidden",value:function(){return this._outer.classList.contains("-hidden")}},{key:"_isInGallery",value:function(){for(var t in this._collection)if("__"!==t&&this._collection[t].includes(this._current))return!0;return!1}},{key:"_isFirst",value:function(){return 0===this._collection[this._current.dataset.gallery.toUpperCase()].indexOf(this._current)}},{key:"_isLast",value:function(){var t=this._collection[this._current.dataset.gallery.toUpperCase()];return t.indexOf(this._current)===t.length-1}},{key:"_getNext",value:function(){var t=this._collection[this._current.dataset.gallery.toUpperCase()];return t[t.indexOf(this._current)+1]}},{key:"_getPrev",value:function(){var t=this._collection[this._current.dataset.gallery.toUpperCase()];return t[t.indexOf(this._current)-1]}},{key:"_buildCollection",value:function(){var t=document.querySelectorAll(this.options.el),s={__:[]};t.forEach(function(t){var e=t.dataset.gallery;e?(s.hasOwnProperty(e.toUpperCase())||(s[e.toUpperCase()]=[]),s[e.toUpperCase()].push(t)):s.__.push(t)}),this._collection=s}},{key:"_showLoader",value:function(){this._structure.LOADER.classList.remove("hidden")}},{key:"_hideLoader",value:function(){this._structure.LOADER.classList.add("hidden")}},{key:"_showError",value:function(){this._structure.ERROR.classList.remove("hidden")}}],[{key:"_isObject",value:function(t){return t&&"object"===(void 0===t?"undefined":_typeof(t))&&!Array.isArray(t)}},{key:"_merge",value:function(e,s){var i=Object.assign({},e);return Object.keys(s).forEach(function(t){n._isObject(s[t])&&t in e?i[t]=n._merge(e[t],s[t]):Object.assign(i,_defineProperty({},t,s[t]))}),i}},{key:"defaults",get:function(){return{el:"[data-litebox]",target:"href",caption:"title",keyboardShortcuts:!0,touch:!0,autohideControls:!0,loop:!1,animations:!0,labels:{close:"Close",next:"Show next image",prev:"Show previous image",error:"Sorry, the image couldn't be loaded."},classNames:{outer:"litebox",inner:"litebox__inner",figure:"litebox__image__wrapper",caption:"litebox__caption",image:"litebox__image",buttonGeneral:"litebox__button",buttonClose:"litebox__button--close",buttonPrev:"litebox__button--prev",buttonNext:"litebox__button--next",loader:"litebox__loader",error:"litebox__error",hidden:"hidden"}}}}]),n}();