"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Litebox=function(){function t(e){_classCallCheck(this,t),this.defaults={selector:{el:"[data-litebox]",target:"href",caption:"title"},animations:{fadeIn:800,fadeOut:800},labels:{close:"Close",next:"Next image",prev:"Prev image"}},this.images=document.querySelectorAll(this.defaults.selector.el),this.litebox=null,this.image=null,this.timeout=null,this.index=0,this.registerEvents()}return _createClass(t,[{key:"registerEvents",value:function(){var i=this;this.images.forEach(function(t){t.addEventListener("click",function(e){i.index=Array.from(i.images).indexOf(t),i.prepare(e,t)})}),window.addEventListener("keydown",function(e){if(i.litebox)switch(e.keyCode){case 27:i.close();break;case 39:i.next();break;case 37:i.prev()}})}},{key:"registerHandlers",value:function(e,t,i,n){t.addEventListener("click",this.next.bind(this)),i.addEventListener("click",this.prev.bind(this)),e.addEventListener("click",this.close.bind(this)),n.addEventListener("mouseenter",this.showControls.bind(this)),n.addEventListener("mouseleave",this.hideControls.bind(this)),n.addEventListener("mousemove",this.clearTimeout.bind(this))}},{key:"close",value:function(e){var t=this;this.litebox.classList.add("-fade-out"),setTimeout(function(){document.body.removeChild(t.litebox),t.litebox=null,t.figure=null,t.index=0},this.defaults.animations.fadeOut)}},{key:"next",value:function(){var t=this;this.index!==this.images.length-1&&(this.litebox.classList.add("-hide-image-left"),this.litebox.addEventListener("animationend",function(e){t.index++,t.replaceImage(t.images[t.index]).then(function(){t.litebox.classList.remove("-hide-image-left"),t.litebox.classList.add("-show-image-right"),t.litebox.addEventListener("animationend",function(e){"show-image-right"===e.animationName&&t.litebox.classList.remove("-show-image-right")})})},{once:!0}))}},{key:"prev",value:function(){var t=this;this.index<=0||(this.litebox.classList.add("-hide-image-right"),this.litebox.addEventListener("animationend",function(e){t.index--,t.replaceImage(t.images[t.index]).then(function(){t.litebox.classList.remove("-hide-image-right"),t.litebox.classList.add("-show-image-left"),t.litebox.addEventListener("animationend",function(e){"show-image-left"===e.animationName&&t.litebox.classList.remove("-show-image-left")})})},{once:!0}))}},{key:"replaceImage",value:function(n){var a=this;return new Promise(function(e,t){var i=n.getAttribute(a.defaults.selector.caption);a.image.src=n.getAttribute(a.defaults.selector.target),a.image.alt=n.getAttribute(a.defaults.selector.caption),i?(a.image.nextElementSibling.textContent=i,a.image.nextElementSibling.removeAttribute("hidden")):a.image.nextElementSibling.setAttribute("hidden",!0),a.image.onload=e})}},{key:"prepare",value:function(e,t){var i=this;e.preventDefault();var n=t.getAttribute(this.defaults.selector.target),a=t.getAttribute(this.defaults.selector.caption);n&&(this.litebox=document.body.appendChild(this.createHTML(n,a)),this.litebox.firstElementChild.addEventListener("animationend",function(e){i.litebox.classList.remove("-fade-in")},{once:!0}))}},{key:"showControls",value:function(){var e=this;this.litebox.classList.remove("-inactive"),this.timeout=setTimeout(function(){e.hideControls()},500)}},{key:"hideControls",value:function(){var e=this;this.timeout=setTimeout(function(){e.litebox.classList.add("-inactive")},1e3)}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){clearTimeout(this.timeout),this.showControls()})},{key:"createHTML",value:function(e,t){var i=document.createElement("div");i.classList.add("litebox-outer","-fade-in","-inactive");var n=document.createElement("div");n.classList.add("litebox-inner");var a=document.createElement("button");a.type="button",a.title=this.defaults.labels.close,a.classList.add("litebox-button-close","litebox-button");var s=document.createElement("button");s.type="button",s.title=this.defaults.labels.next,s.classList.add("litebox-button-next","litebox-button");var o=document.createElement("button");o.type="button",o.title=this.defaults.labels.prev,o.classList.add("litebox-button-prev","litebox-button");var l=new Image;l.src=e,l.alt=t,l.classList.add("litebox-image");var r=document.createElement("figure");r.classList.add("litebox-image-wrapper"),r.appendChild(l);var d=document.createElement("figcaption");return d.classList.add("litebox-image-caption"),d.textContent=t||"",t||d.classList.add("-hidden"),r.appendChild(d),i.appendChild(n),n.appendChild(a),n.appendChild(s),n.appendChild(o),n.appendChild(r),this.registerHandlers(a,s,o,n),this.image=l,i}}]),t}();