"use strict";function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var Litebox=function(){"use strict";var a=function(){function a(b){var c=this;_classCallCheck(this,a),_defineProperty(this,"handleOpen",function(a){c._current=a;var b=c.render(c.getTemplate().content.cloneNode(!0),a);document.body.appendChild(b),c._litebox=document.querySelector("[data-action=\"wrapper\"]"),c.registerEvents()}),_defineProperty(this,"handleClick",function(a){switch(a.target.dataset.action){case"next":case"prev":c["switch"](a.target.dataset.action);break;case"wrapper":case"close":c.close();}}),_defineProperty(this,"handleKeyDown",function(a){switch(a.keyCode){case 27:c.close();break;case 39:c["switch"]("next");break;case 37:c["switch"]("prev");}}),_defineProperty(this,"handleTouchStart",function(a){c._x=a.touches[0].clientX,c._y=a.touches[0].clientY}),_defineProperty(this,"handleTouchMove",function(a){var b=Math.abs,d=a.touches[0].clientX,e=a.touches[0].clientY;b(c._x-d)>b(c._y-e)?0<c._x-d?c["switch"]("next"):c["switch"]("prev"):0>c._y-e&&c.close(),c._x=null,c._y=null}),b&&!a._isObject(b)?(console.warn("[Litebox] Expected an object as configuration, received ".concat(_typeof(b),". Default configuration is used instead.")),this.options=a.defaults):this.options=a._merge(a.defaults,b),this._current=null,this._litebox=null,this._x=0,this._y=0,this._images=document.querySelectorAll(this.options.el),this._buildCollection(this._images),this._images.forEach(function(a){return a.addEventListener("click",function(b){b.preventDefault(),c.handleOpen(a)})})}return _createClass(a,[{key:"getTemplate",value:function getTemplate(){var a=document.createElement("template"),b=document.querySelector(this.options.template);return a.innerHTML=b?b.innerHTML||"\n    <div class=\"litebox\" data-action=\"wrapper\">\n      <div class=\"litebox-wrapper\" data-action=\"inner\">\n        <button class=\"litebox-button litebox-button-close\" data-action=\"close\">Close</button>\n        <button class=\"litebox-button litebox-button-next\" data-action=\"next\">Show next image</button>\n        <button class=\"litebox-button litebox-button-prev\" data-action=\"prev\">Show previous image</button>\n        <figure class=\"litebox-image-wrapper\">\n          <img class=\"litebox-image\" data-action=\"image\">\n          <figcaption class=\"litebox-caption\" data-action=\"caption\"></figcaption>\n        </figure>\n      </div>\n      <div class=\"litebox-error\" data-action=\"error\">Sorry, the image couldn't be loaded.</div>\n      <div class=\"litebox-loader\" data-action=\"loader\"></div>\n    </div>\n  ":"\n    <div class=\"litebox\" data-action=\"wrapper\">\n      <div class=\"litebox-wrapper\" data-action=\"inner\">\n        <button class=\"litebox-button litebox-button-close\" data-action=\"close\">Close</button>\n        <button class=\"litebox-button litebox-button-next\" data-action=\"next\">Show next image</button>\n        <button class=\"litebox-button litebox-button-prev\" data-action=\"prev\">Show previous image</button>\n        <figure class=\"litebox-image-wrapper\">\n          <img class=\"litebox-image\" data-action=\"image\">\n          <figcaption class=\"litebox-caption\" data-action=\"caption\"></figcaption>\n        </figure>\n      </div>\n      <div class=\"litebox-error\" data-action=\"error\">Sorry, the image couldn't be loaded.</div>\n      <div class=\"litebox-loader\" data-action=\"loader\"></div>\n    </div>\n  ",a}},{key:"loadImage",value:function loadImage(a,b){return new Promise(function(c,d){var e=new Image;e.onload=c,e.onerror=d,e.src=a,b.src=a})}},{key:"render",value:function render(a,b){var c=b.getAttribute(this.options.target),d=b.getAttribute(this.options.caption),e=a.querySelector("[data-action=\"caption\"]"),f=a.querySelector("[data-action=\"inner\"]"),g=a.querySelector("[data-action=\"image\"]"),h=a.querySelector("[data-action=\"next\"]"),i=a.querySelector("[data-action=\"error\"]"),j=a.querySelector("[data-action=\"loader\"]"),k=a.querySelector("[data-action=\"prev\"]");return i.setAttribute("hidden",!0),f.setAttribute("hidden",!0),j.removeAttribute("hidden"),h.setAttribute("hidden",!0),k.setAttribute("hidden",!0),this.loadImage(c,g).then(function(){return f.removeAttribute("hidden")})["catch"](function(){return i.removeAttribute("hidden")})["finally"](function(){return j.setAttribute("hidden",!0)}),d?(e.removeAttribute("hidden"),e.textContent=d):(e.setAttribute("hidden",!0),e.textContent=""),this._isInGallery()&&((!this._isLast()||this.options.loop)&&h.removeAttribute("hidden"),(!this._isFirst()||this.options.loop)&&k.removeAttribute("hidden")),a}},{key:"close",value:function close(){this._litebox&&(document.body.removeChild(this._litebox),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),this._litebox=null,this._current=null)}},{key:"switch",value:function _switch(a){var b=this.exists(a);b&&(this._current=b,this.render(this._litebox,b))}},{key:"exists",value:function exists(a){if(!this._current||!this._isInGallery())return!1;var b=this._collection[this._current.dataset.gallery.toUpperCase()],c=b.indexOf(this._current);return"next"===a?this.options.loop&&c+1===b.length?b[0]:b[c+1]||!1:"prev"===a?this.options.loop&&0===c?b[b.length-1]:b[c-1]||!1:void 0}},{key:"registerEvents",value:function registerEvents(){this._litebox.addEventListener("click",this.handleClick),this.options.keyboard&&window.addEventListener("keydown",this.handleKeyDown),this.options.touch&&(window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchmove",this.handleTouchMove))}},{key:"_isInGallery",value:function _isInGallery(){for(var a in this._collection)if("__"!=a&&-1!==this._collection[a].indexOf(this._current))return!0;return!1}},{key:"_isFirst",value:function _isFirst(){var a=this._collection[this._current.dataset.gallery.toUpperCase()];return 0===a.indexOf(this._current)}},{key:"_isLast",value:function _isLast(){var a=this._collection[this._current.dataset.gallery.toUpperCase()];return a.indexOf(this._current)===a.length-1}},{key:"_buildCollection",value:function _buildCollection(a){var b={__:[]};[].forEach.call(a,function(a){var c=a.dataset.gallery;c?(!b.hasOwnProperty(c.toUpperCase())&&(b[c.toUpperCase()]=[]),b[c.toUpperCase()].push(a)):b.__.push(a)}),this._collection=b}}],[{key:"_isObject",value:function _isObject(a){return a&&"object"===_typeof(a)&&!Array.isArray(a)}},{key:"_merge",value:function _merge(b,c){var d=Object.assign({},b);return Object.keys(c).forEach(function(e){a._isObject(c[e])?e in b?d[e]=a._merge(b[e],c[e]):Object.assign(d,_defineProperty({},e,c[e])):Object.assign(d,_defineProperty({},e,c[e]))}),d}},{key:"defaults",get:function get(){return{el:"[data-litebox]",target:"href",caption:"title",keyboard:!0,touch:!0,autohideControls:!0,slideshow:5e3,loop:!1,animation:500,labels:{close:"Close",next:"Show next image",prev:"Show previous image",error:"Sorry, the image couldn't be loaded."}}}}]),a}();return a}();