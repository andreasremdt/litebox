"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Litebox=function(){function s(t){_classCallCheck(this,s),s._isObject(t)?this.options=s._merge(s.defaults,t):(this.options=s.defaults,console.warn("(Litebox): The given object for options is invalid, please make sure that you submit an actual object. Default options will be used.")),this.elements=document.querySelectorAll(this.options.el),this._current=null,this.VERSION="0.7.0",this.init()}return _createClass(s,[{key:"init",value:function(){this.createElements(),this.build(),this.registerMouseEvents(),this.registerTouchEvents(),this.registerKeyboardEvents(),this.slideshow()}},{key:"createElements",value:function(){this._close=document.createElement("button"),this._next=document.createElement("button"),this._prev=document.createElement("button"),this._outer=document.createElement("div"),this._inner=document.createElement("div"),this._figure=document.createElement("figure"),this._caption=document.createElement("ficaption"),this._image=new Image}},{key:"build",value:function(){this._outer.className=this.options.classNames.outer+" "+(this.options.animation&&"-fade-in"),this._inner.className=this.options.classNames.inner,this._close.className=this.options.classNames.buttonGeneral+" "+this.options.classNames.buttonClose,this._close.title=this.options.labels.close,this._next.className=this.options.classNames.buttonGeneral+" "+this.options.classNames.buttonNext,this._next.title=this.options.labels.next,this._prev.className=this.options.classNames.buttonGeneral+" "+this.options.classNames.buttonPrev,this._prev.title=this.options.labels.prev,this._figure.className=this.options.classNames.figure,this._caption.className=this.options.classNames.caption,this._image.className=this.options.classNames.image,this._outer.appendChild(this._inner),this._inner.appendChild(this._close),this.options.gallery&&(this._inner.appendChild(this._next),this._inner.appendChild(this._prev)),this._inner.appendChild(this._figure),this._figure.appendChild(this._image),this._figure.appendChild(this._caption)}},{key:"registerKeyboardEvents",value:function(){var e=this;this.options.keyboardShortcuts&&window.addEventListener("keydown",function(t){e.isHidden()||(27===t.keyCode&&e.close(),39===t.keyCode&&e.options.gallery&&e.next(),37===t.keyCode&&e.options.gallery&&e.prev())})}},{key:"registerTouchEvents",value:function(){var n=this;if(this.options.touch){var s=null,o=null;window.addEventListener("touchstart",function(t){n.isHidden()||(s=t.touches[0].clientX,o=t.touches[0].clientY)}),window.addEventListener("touchmove",function(t){if(!n.isHidden()&&s&&o){var e=t.touches[0].clientX,i=t.touches[0].clientY;Math.abs(s-e)>Math.abs(o-i)?0<s-e?n.next():n.prev():o-i<0&&n.close(),o=s=null}})}}},{key:"registerMouseEvents",value:function(){var i=this;this.elements.forEach(function(e){e.addEventListener("click",function(t){i.handleImageChange(e),t.preventDefault()})}),this._next.addEventListener("click",this.next.bind(this)),this._prev.addEventListener("click",this.prev.bind(this)),this._close.addEventListener("click",this.close.bind(this)),this._outer.addEventListener("click",function(t){return t.target===i._outer&&i.close()}),this.options.autohideControls&&(this._inner.addEventListener("mouseenter",this.showControls.bind(this)),this._inner.addEventListener("mouseleave",this.hideControls.bind(this)),this._inner.addEventListener("mousemove",this.clearTimeout.bind(this)))}},{key:"slideshow",value:function(){var t=this;this.options.slideshow&&(isNaN(parseInt(this.options.slideshow))?console.warn("(Litebox): Received an invalid number for the slideshow timing. '"+this.options.slideshow+"' is not a number."):this._interval=setInterval(function(){t.next()},this.options.slideshow))}},{key:"handleImageChange",value:function(t){var e=this;this._current=Array.from(this.elements).indexOf(t),this.load(t).then(function(){document.body.contains(e._outer)?e._outer.className=e.options.classNames.outer+" "+(e.options.animation&&"-fade-in"):document.body.appendChild(e._outer),setTimeout(function(){e._outer.classList.remove("-fade-in")},800)})}},{key:"load",value:function(t){var i=this,n=t.getAttribute(this.options.target);if(n)return this.toggleCaption(t.getAttribute(this.options.caption)),this.toggleButtons(),new Promise(function(t,e){i._image.src=n,i._image.onload=t})}},{key:"toggleCaption",value:function(t){t?(this._caption.textContent=t,this._caption.classList.remove("-hidden")):this._caption.classList.add("-hidden")}},{key:"toggleButtons",value:function(){this.isLast()&&!this.options.loop?this._next.classList.add("-hidden"):this._next.classList.remove("-hidden"),this.isFirst()&&!this.options.loop?this._prev.classList.add("-hidden"):this._prev.classList.remove("-hidden")}},{key:"animate",value:function(t){t}},{key:"close",value:function(t){var e=this;this.options.animation&&this._outer.classList.add("-fade-out"),this._current=null,setTimeout(function(){e._outer.classList.add("-hidden")},this.options.animation?800:0)}},{key:"next",value:function(){var e=this;if(this._current===this.elements.length-1){if(!this.options.loop)return void(this._interval&&clearInterval(this._interval));this._current=-1}this._outer.classList.add("-hide-image-left"),this._outer.addEventListener("animationend",function(t){e._current++,e.load(e.elements[e._current]).then(function(){e._outer.classList.remove("-hide-image-left"),e._outer.classList.add("-show-image-right"),e._outer.addEventListener("animationend",function(t){"show-image-right"===t.animationName&&e._outer.classList.remove("-show-image-right")})})},{once:!0})}},{key:"prev",value:function(){var e=this;if(this._current<=0){if(!this.options.loop)return;this._current=this.elements.length}this._outer.classList.add("-hide-image-right"),this._outer.addEventListener("animationend",function(t){e._current--,e.load(e.elements[e._current]).then(function(){e._outer.classList.remove("-hide-image-right"),e._outer.classList.add("-show-image-left"),e._outer.addEventListener("animationend",function(t){"show-image-left"===t.animationName&&e._outer.classList.remove("-show-image-left")})})},{once:!0})}},{key:"showControls",value:function(){var t=this;this._outer.classList.remove("-inactive"),this.timeout=setTimeout(function(){t.hideControls()},2e3)}},{key:"hideControls",value:function(){this._outer.classList.add("-inactive")}},{key:"clearTimeout",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){clearTimeout(this.timeout),this.showControls()})},{key:"isHidden",value:function(){return this._outer.classList.contains("-hidden")}},{key:"isLast",value:function(){return this._current===this.elements.length-1}},{key:"isFirst",value:function(){return this._current<=0}}],[{key:"_isObject",value:function(t){return t&&"object"===(void 0===t?"undefined":_typeof(t))&&!Array.isArray(t)}},{key:"_merge",value:function(e,i){var n=Object.assign({},e);return Object.keys(i).forEach(function(t){s._isObject(i[t])&&t in e?n[t]=s._merge(e[t],i[t]):Object.assign(n,_defineProperty({},t,i[t]))}),n}},{key:"defaults",get:function(){return{el:"[data-litebox]",target:"href",caption:"title",gallery:!0,keyboardShortcuts:!0,touch:!0,autohideControls:!0,loop:!1,slideshow:!1,animation:!0,labels:{close:"Close Litebox",next:"Next image",prev:"Previous image"},classNames:{outer:"litebox-outer",inner:"litebox-inner",figure:"litebox-image-wrapper",caption:"litebox-image-caption",image:"litebox-image",buttonGeneral:"litebox-button",buttonClose:"litebox-button-close",buttonPrev:"litebox-button-prev",buttonNext:"litebox-button-next"}}}}]),s}();